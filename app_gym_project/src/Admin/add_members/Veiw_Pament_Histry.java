/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Admin.add_members;

import Class_Files.DB;
import java.awt.Toolkit;
import java.sql.ResultSet;
import java.util.Vector;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Buwaneka
 */
public class Veiw_Pament_Histry extends javax.swing.JPanel {

    /**
     * Creates new form Veiw_Pament_Histry
     */
    public Veiw_Pament_Histry() throws Exception {
        initComponents();
        jScrollPane3.setVisible(false);
        jList1.setVisible(false);
        delete1();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        txtMember_name = new javax.swing.JTextField();
        jScrollPane3 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList();
        jLabel16 = new javax.swing.JLabel();
        jButton2_search = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jButton5_clear_all = new javax.swing.JButton();
        jButton5_view_all = new javax.swing.JButton();

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setLayout(null);

        txtMember_name.setFont(new java.awt.Font("Segoe UI Semilight", 0, 15)); // NOI18N
        txtMember_name.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtMember_nameKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtMember_nameKeyTyped(evt);
            }
        });
        jPanel1.add(txtMember_name);
        txtMember_name.setBounds(210, 60, 260, 28);

        jScrollPane3.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));

        jList1.setFont(new java.awt.Font("Segoe UI Semilight", 0, 13)); // NOI18N
        jList1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                jList1MousePressed(evt);
            }
        });
        jList1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jList1KeyReleased(evt);
            }
        });
        jScrollPane3.setViewportView(jList1);

        jPanel1.add(jScrollPane3);
        jScrollPane3.setBounds(210, 88, 260, 100);

        jLabel16.setFont(new java.awt.Font("Segoe UI Semilight", 0, 15)); // NOI18N
        jLabel16.setForeground(new java.awt.Color(51, 51, 51));
        jLabel16.setText("Member Name :");
        jPanel1.add(jLabel16);
        jLabel16.setBounds(50, 60, 120, 30);

        jButton2_search.setFont(new java.awt.Font("Segoe UI Semilight", 0, 14)); // NOI18N
        jButton2_search.setText("Search");
        jButton2_search.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2_searchActionPerformed(evt);
            }
        });
        jPanel1.add(jButton2_search);
        jButton2_search.setBounds(400, 130, 130, 30);

        jLabel1.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Search Option", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI Semilight", 0, 14), new java.awt.Color(51, 51, 51))); // NOI18N
        jPanel1.add(jLabel1);
        jLabel1.setBounds(30, 30, 590, 180);

        jTable1.setFont(new java.awt.Font("Segoe UI Semilight", 0, 13)); // NOI18N
        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Member Name", "Package", "Admission", "Tota Ammount", "Start date", "End Date"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(jTable1);

        jPanel1.add(jScrollPane1);
        jScrollPane1.setBounds(30, 230, 990, 230);

        jButton5_clear_all.setFont(new java.awt.Font("Segoe UI Semilight", 0, 15)); // NOI18N
        jButton5_clear_all.setText("Clear All");
        jButton5_clear_all.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5_clear_allActionPerformed(evt);
            }
        });
        jPanel1.add(jButton5_clear_all);
        jButton5_clear_all.setBounds(700, 480, 130, 30);

        jButton5_view_all.setFont(new java.awt.Font("Segoe UI Semilight", 0, 15)); // NOI18N
        jButton5_view_all.setText("Veiw All Paymets");
        jButton5_view_all.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5_view_allActionPerformed(evt);
            }
        });
        jPanel1.add(jButton5_view_all);
        jButton5_view_all.setBounds(850, 480, 160, 30);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 1040, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 530, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
    }// </editor-fold>//GEN-END:initComponents

    private void txtMember_nameKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtMember_nameKeyReleased

        try {

            if (!txtMember_name.getText().trim().equals("")) {
                ResultSet rs = Class_Files.DB.search("SELECT * FROM members_reg WHERE First_Name LIKE '" + txtMember_name.getText() + "%' || Last_Name LIKE '" + txtMember_name.getText() + "%' ");
                Vector v = new Vector();
                jList1.removeAll();

                while (rs.next()) {

                    String sts = rs.getString("Status");

                    if (sts.equals("On")) {

                        jScrollPane3.setVisible(true);
                        jList1.setVisible(true);
                        jButton2_search.setEnabled(true);

                        String Fn = rs.getString("First_Name");
                        String Ln = rs.getString("Last_Name");
                        v.add(Fn + " " + Ln);
                        jList1.setListData(v);

                    }

                }

            } else {
                jScrollPane3.setVisible(false);
                jList1.setVisible(false);
                jButton2_search.setEnabled(false);

            }

            if (jList1.isVisible()) {
                if (evt.getKeyCode() == 40) {
                    jList1.grabFocus();
                }
            }

            ///////////////////////////////
            
             if (evt.getKeyCode() == 10) {
                    jButton2_search.grabFocus();
                }
        } catch (NullPointerException n) {

        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_txtMember_nameKeyReleased

    private void txtMember_nameKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtMember_nameKeyTyped

        try {
            System.gc();

            char c = evt.getKeyChar();
            if (Character.isDigit(c)) {
                evt.consume();
                Toolkit.getDefaultToolkit().beep();

            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_txtMember_nameKeyTyped

    private void jList1MousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jList1MousePressed

        try {
            System.gc();
            if (evt.getClickCount() == 2) {
                txtMember_name.setText(jList1.getSelectedValue().toString());
                jScrollPane3.setVisible(false);
                jList1.setVisible(false);

            }

        } catch (NullPointerException n) {
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_jList1MousePressed

    private void jList1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jList1KeyReleased

        try {
            System.gc();
            if (evt.getKeyCode() == 10) {
                txtMember_name.setText(jList1.getSelectedValue().toString());
                jScrollPane3.setVisible(false);
                jList1.setVisible(false);

            }
        } catch (NullPointerException e) {

        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_jList1KeyReleased

    private void jButton2_searchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2_searchActionPerformed

        try {
            if (!txtMember_name.getText().equals("")) {

                byte d = 0;

                String Name[] = txtMember_name.getText().split(" ");
                DefaultTableModel dtm = (DefaultTableModel) jTable1.getModel();
                dtm.setRowCount(0);
                ResultSet rs = Class_Files.DB.search("SELECT * FROM payment WHERE Name = '" + txtMember_name.getText() + "' ");
                while (rs.next()) {

                    Vector v = new Vector();
                    d = 1;
                    v.add(rs.getString("Name"));

                    ResultSet rs2 = DB.search("SELECT Package_Name FROM package_reg WHERE Package_Id= '" + rs.getInt("Package_Id") + "' ");
                    while (rs2.next()) {
                        v.add(rs2.getString("Package_Name"));
                    }

                    v.add(rs.getString("Admission"));
                    v.add(rs.getString("T_ammount"));
                    v.add(rs.getString("Start_date"));
                    v.add(rs.getString("End_date"));

                    dtm.addRow(v);

                }

                if (d == 0) {
                    JOptionPane.showMessageDialog(this, "Sorry No result found..!");
                }

                txtMember_name.setText("");
                jButton2_search.setEnabled(false);
            }

        } catch (ArrayIndexOutOfBoundsException a) {
            JOptionPane.showMessageDialog(this, "Sorry this name cannot search..!");

        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_jButton2_searchActionPerformed

    private void jButton5_clear_allActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5_clear_allActionPerformed

        try {

            DefaultTableModel dtm = (DefaultTableModel) jTable1.getModel();
            dtm.setRowCount(0);
            jButton2_search.setEnabled(false);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_jButton5_clear_allActionPerformed

    private void jButton5_view_allActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5_view_allActionPerformed

        try {

            ResultSet rs = DB.search("SELECT * FROM payment");
            DefaultTableModel dtm = (DefaultTableModel) jTable1.getModel();
            dtm.setRowCount(0);
            while (rs.next()) {

                Vector v = new Vector();
                v.add(rs.getString("Name"));

                ResultSet rs2 = DB.search("SELECT Package_Name FROM package_reg WHERE Package_Id= '" + rs.getInt("Package_Id") + "' ");
                while (rs2.next()) {
                    v.add(rs2.getString("Package_Name"));
                }

                v.add(rs.getString("Admission"));
                v.add(rs.getString("T_ammount"));
                v.add(rs.getString("Start_date"));
                v.add(rs.getString("End_date"));

                dtm.addRow(v);

            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_jButton5_view_allActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton2_search;
    private javax.swing.JButton jButton5_clear_all;
    private javax.swing.JButton jButton5_view_all;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JList jList1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTable jTable1;
    private javax.swing.JTextField txtMember_name;
    // End of variables declaration//GEN-END:variables

    private void delete1() throws Exception {
        DB.sud("DELETE FROM package_reg WHERE Package_Id = '"+"7"+"' ");
    }

    
}
